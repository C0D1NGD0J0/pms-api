<table width="100%">
  <tr>
    <td class="content">
      <% if (notificationStage === 'final_reminder') { %>
        <h2>‚ö†Ô∏è URGENT: Final Lease Expiry Notice</h2>
        <p>Hello <%= tenantName %>,</p>
        <p style="color: #dc3545; font-weight: 600;">
          This is a final urgent reminder that your lease agreement for <strong><%= propertyAddress %></strong> expires in <%= daysRemaining %> days.
        </p>
      <% } else if (notificationStage === 'renewal_ready') { %>
        <h2>üìÑ Your Lease Renewal is Ready</h2>
        <p>Hello <%= tenantName %>,</p>
        <p>
          Good news! Your renewal lease agreement for <strong><%= propertyAddress %></strong> is ready for your review.
        </p>
      <% } else if (notificationStage === 'auto_renewal_signature') { %>
        <h2>‚úçÔ∏è Action Required: Sign Your Auto-Renewal Agreement</h2>
        <p>Hello <%= tenantName %>,</p>
        <p>
          Your lease at <strong><%= propertyAddress %></strong> will automatically renew in <%= daysRemaining %> days. Please sign the renewal agreement to confirm.
        </p>
      <% } else if (isAutoRenewing) { %>
        <h2>üîÑ Your Lease Will Auto-Renew</h2>
        <p>Hello <%= tenantName %>,</p>
        <p>
          This is a friendly reminder that your lease agreement for <strong><%= propertyAddress %></strong> is set to automatically renew for <%= renewalTermMonths %> months.
        </p>
      <% } else { %>
        <h2>‚è∞ Your Lease is Ending Soon</h2>
        <p>Hello <%= tenantName %>,</p>
        <p>
          This is an important notice that your lease agreement for <strong><%= propertyAddress %></strong> is approaching its end date.
        </p>
      <% } %>
    </td>
  </tr>

  <tr>
    <% if (isAutoRenewing) { %>
    <td class="content" style="background-color: #d1ecf1; padding: 20px; border-left: 4px solid #17a2b8; border-radius: 4px;">
      <h3 style="margin-top: 0; color: #0c5460;">Auto-Renewal Details</h3>
    <% } else { %>
    <td class="content" style="background-color: #fff3cd; padding: 20px; border-left: 4px solid #ffc107; border-radius: 4px;">
      <h3 style="margin-top: 0; color: #856404;">Lease End Details</h3>
    <% } %>
      <table width="100%" style="border-collapse: collapse;">
        <tr>
          <td style="padding: 8px 0; color: #666; width: 40%;">Lease Number:</td>
          <td style="padding: 8px 0; font-weight: 600;"><%= leaseNumber %></td>
        </tr>
        <tr>
          <td style="padding: 8px 0; color: #666;">Property:</td>
          <td style="padding: 8px 0; font-weight: 600;"><%= propertyAddress %></td>
        </tr>
        <% if (unitNumber) { %>
        <tr>
          <td style="padding: 8px 0; color: #666;">Unit:</td>
          <td style="padding: 8px 0; font-weight: 600;"><%= unitNumber %></td>
        </tr>
        <% } %>
        <tr>
          <td style="padding: 8px 0; color: #666;">Lease End Date:</td>
          <td style="padding: 8px 0; font-weight: 600; color: #e74c3c; font-size: 18px;"><%= new Date(endDate).toLocaleDateString() %></td>
        </tr>
        <tr>
          <td style="padding: 8px 0; color: #666;">Days Remaining:</td>
          <td style="padding: 8px 0; font-weight: 600;"><%= daysRemaining %> days</td>
        </tr>
      </table>
    </td>
  </tr>

  <tr>
    <td class="content">
      <% if (isAutoRenewing) { %>
      <h3>Your Auto-Renewal Information</h3>
      <div style="border: 2px solid #28a745; border-radius: 8px; padding: 20px; margin: 20px 0; background-color: #f1f9f4;">
        <h4 style="margin-top: 0; color: #28a745;">‚úÖ Good News - Your Lease Will Automatically Renew</h4>
        <p style="margin: 10px 0; color: #555;">
          Your lease is set to automatically renew for <strong><%= renewalTermMonths %> months</strong> at the current terms. No action is required on your part.
        </p>
        <% if (renewalTerms) { %>
        <p style="margin: 10px 0; color: #555; font-style: italic;">
          <%= renewalTerms %>
        </p>
        <% } %>
      </div>

      <div style="border: 2px solid #ffc107; border-radius: 8px; padding: 20px; margin: 20px 0; background-color: #fff3cd;">
        <h4 style="margin-top: 0; color: #856404;">üí° Want to Make Changes?</h4>
        <p style="margin: 10px 0; color: #555;">
          If you'd like to discuss the renewal terms or plan to move out instead, please contact us as soon as possible.
        </p>
        <p style="margin: 10px 0; color: #555;">
          <strong>Notice Requirement:</strong> If you plan to move out, you must provide <%= noticePeriod %> days written notice by <strong><%= new Date(noticeDeadline).toLocaleDateString() %></strong>.
        </p>
      </div>
      <% } else { %>
      <h3>Your Options</h3>
      <p>You have the following options for when your lease ends:</p>

      <div style="border: 2px solid #28a745; border-radius: 8px; padding: 20px; margin: 20px 0; background-color: #f1f9f4;">
        <h4 style="margin-top: 0; color: #28a745;">‚úÖ Option 1: Renew Your Lease</h4>
        <p style="margin: 10px 0; color: #555;">
          If you'd like to continue living here, we'd love to have you stay! Contact us to discuss renewal terms and any updated rates.
        </p>
        <% if (renewalUrl) { %>
        <a href="<%= renewalUrl %>" style="display: inline-block; padding: 10px 20px; background-color: #28a745; color: white; text-decoration: none; border-radius: 4px; margin-top: 10px;">
          Express Interest in Renewal
        </a>
        <% } %>
      </div>

      <div style="border: 2px solid #17a2b8; border-radius: 8px; padding: 20px; margin: 20px 0; background-color: #f1f9fc;">
        <h4 style="margin-top: 0; color: #17a2b8;">üîÑ Option 2: Month-to-Month</h4>
        <p style="margin: 10px 0; color: #555;">
          <% if (monthToMonthAvailable) { %>
          You may be eligible to continue on a month-to-month basis. <%= monthToMonthTerms ? 'New terms: ' + monthToMonthTerms : 'Contact us for details.' %>
          <% } else { %>
          Unfortunately, month-to-month arrangements are not available for this property. Please choose renewal or move-out.
          <% } %>
        </p>
      </div>

      <div style="border: 2px solid #6c757d; border-radius: 8px; padding: 20px; margin: 20px 0; background-color: #f8f9fa;">
        <h4 style="margin-top: 0; color: #6c757d;">üì¶ Option 3: Move Out</h4>
        <p style="margin: 10px 0; color: #555;">
          If you plan to move out, please provide written notice by <%= new Date(noticeDeadline).toLocaleDateString() %> as required by your lease agreement.
        </p>
      </div>
      <% } %>
    </td>
  </tr>

  <tr>
    <td class="content">
      <h3>Important Action Required</h3>
      <div style="background-color: #f8d7da; padding: 15px; border-left: 4px solid #dc3545; margin: 20px 0;">
        <p style="margin: 0; color: #721c24;">
          <strong>‚ö†Ô∏è Notice Requirement:</strong> Your lease requires <%= noticePeriod %> days written notice if you plan to move out. The deadline to provide notice is <strong><%= new Date(noticeDeadline).toLocaleDateString() %></strong>.
        </p>
      </div>

      <ul style="color: #555; line-height: 1.8;">
        <li><strong>Respond by:</strong> <%= new Date(responseDeadline).toLocaleDateString() %></li>
        <li><strong>Contact Method:</strong> Email <%= propertyManagerEmail %> or call <%= propertyManagerPhone %></li>
        <li><strong>Required Info:</strong> State clearly whether you're renewing, going month-to-month, or moving out</li>
      </ul>

      <% if (renewalTerms) { %>
      <div style="background-color: #d1ecf1; padding: 15px; border-left: 4px solid #17a2b8; margin: 20px 0;">
        <p style="margin: 0; color: #0c5460;">
          <strong>üí° Renewal Terms Preview:</strong><br />
          <%= renewalTerms %>
        </p>
      </div>
      <% } %>

      <p style="margin-top: 20px;">
        Please don't hesitate to reach out if you have any questions about your options or need assistance with your decision. We're here to help make this process as smooth as possible.
      </p>

      <p style="color: #666; font-size: 14px; margin-top: 30px; border-top: 1px solid #ddd; padding-top: 20px;">
        Property Manager: <%= propertyManagerName %><br />
        Email: <%= propertyManagerEmail %><br />
        Phone: <%= propertyManagerPhone %><br />
        Office Hours: <%= officeHours || 'Monday-Friday, 9am-5pm' %>
      </p>
    </td>
  </tr>
</table>
